<!DOCTYPE html>
<html>
<head>
    <title>Genshin Abyss Tourney - Player Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-custom">
        <div class="container">
            <a class="navbar-brand" href="home.html">GITV</a>
            <div class="navbar-nav">                    
                <a class="nav-link" href="home.html">Home</a>
                <a class="nav-link" href="index.html">Stats</a>
                <a class="nav-link" href="tournaments.html">Tournaments</a>
                <a class="nav-link" href="news.html">News</a>
                <a class="nav-link" href="players.html">Players Profiles</a>
            </div>
            <form class="d-flex ms-auto" style="position: relative;">
                <input class="form-control me-2" type="search" id="globalSearch" placeholder="Search players..." aria-label="Search">
                <button class="btn btn-outline-light" type="submit">Search</button>
                <div id="suggestions" class="suggestions"></div>
            </form>
        </div>    
    </nav>
    <div class="container mt-4">
        <h1 class="text-center" id="playerName"></h1>
        <div class="row">
            <div class="col-md-4">
                <div class="card bg-dark text-white">
                    <div class="card-body">
                        <img id="playerAvatar" class="rounded-circle mb-2" style="width: 120px; height: 120px;">
                        <h5 class="card-title" id="playerAlias"></h5>
                        <h6 class="card-subtitle mb-2 text-muted" id="playerFullName"></h6>
                        <p class="card-text">Region: <span id="playerRegion"></span></p>
                        <p class="card-text" id="playerTwitter"></p>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h3>Runs</h3>
                <table class="table table-dark table-striped">
                    <thead>
                        <tr><th>#</th><th>Time 1</th><th>Time 2</th><th>Roster</th><th>Bans</th><th>Cost</th></tr>
                    </thead>
                    <tbody id="runList"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        const playerData = {
            "Mark": { region: "EU", avatar: "avatar1.png", name: "Mrak Champ", twitter: "mark_genshin" },
            "Alice": { region: "NA", avatar: "avatar2.png", name: "Alice de Rose", twitter: "alice_plays" },
            "Bob": { region: "TBD", avatar: "default.png", name: "Bob Conqueror", twitter: "" }
        };

        // Get alias from URL
        const params = new URLSearchParams(window.location.search);
        const alias = params.get('alias') || "Mark"; // Fallback
        const player = playerData[alias] || { region: "TBD", avatar: "default.png", name: "Unknown", twitter: "" };
        // Fill profile
        document.getElementById('playerName').textContent = `${player.alias} (${name})`;
        document.getElementById('playerAvatar').src = player.avatar;
        document.getElementById('playerAvatar').alt = alias;
        document.getElementById('playerAlias').textContent = alias;
        document.getElementById('playerFullName').textContent = player.name;
        document.getElementById('playerRegion').textContent = player.region;
        document.getElementById('playerTwitter').innerHTML = player.twitter ? `<a href="https://twitter.com/${player.twitter}" target="_blank">${player.twitter}</a>` : "N/A";

        // Fetch runs
        fetch('./results.json')
            .then(response => response.json())
            .then(data => {
                const runs = data.filter(row => row.player === alias);
                const runList = document.getElementById('runList');
                if (runs.length === 0) {
                    runList.innerHTML = '<tr><td colspan="6">No runs recorded</td></tr>';
                } else {
                    runs.forEach((run, index) => {
                        runList.innerHTML += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${run.time1}</td>
                                <td>${run.time2}</td>
                                <td>${run.roster}</td>
                                <td>${run.bans}</td>
                                <td>${run.cost}</td>
                            </tr>
                        `;
                    });
                }

                // Search (redirects to players.html)
                const search = document.getElementById('globalSearch');
                const suggestions = document.getElementById('suggestions');
                search.addEventListener('input', () => {
                    const term = search.value.toLowerCase();
                    suggestions.innerHTML = '';
                    if (term) {
                        const matches = Object.keys(playerData).filter(p => p.toLowerCase().includes(term) || playerData[p].region.toLowerCase().includes(term));
                        matches.forEach(p => {
                            const div = document.createElement('div');
                            div.textContent = p;
                            div.addEventListener('click', () => {
                                window.location.href = `player.html?alias=${p}`;
                            });
                            suggestions.appendChild(div);
                        });
                    }
                });
                document.querySelector('form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const term = search.value.toLowerCase();
                    const match = Object.keys(playerData).find(p => p.toLowerCase() === term);
                    if (match) window.location.href = `player.html?alias=${match}`;
                });
            })
            .catch(error => console.error('Error fetching results:', error));
    </script>
</body>
</html>