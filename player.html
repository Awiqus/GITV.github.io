<!DOCTYPE html>
<html>
<head>
    <title>Genshin Abyss Tourney - Player Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-custom">
        <div class="container">
            <a class="navbar-brand" href="home.html">GITV</a>
            <div class="navbar-nav">                    
                <a class="nav-link" href="home.html">Home</a>
                <a class="nav-link" href="index.html">Stats</a>
                <a class="nav-link" href="tournaments.html">Tournaments</a>
                <a class="nav-link" href="news.html">News</a>
                <a class="nav-link" href="players.html">Players Profiles</a>
            </div>
            <form class="d-flex ms-auto" style="position: relative;">
                <input class="form-control me-2" type="search" id="globalSearch" placeholder="Search players..." aria-label="Search">
                <button class="btn btn-outline-light" type="submit">Search</button>
                <div id="suggestions" class="suggestions"></div>
            </form>
        </div>    
    </nav>
    <div class="container mt-4">
        <h1 class="text-center" id="playerName"></h1>
        <div class="row">
            <div class="col-md-4">
                <div class="card bg-dark text-white">
                    <div class="card-body">
                        <img id="playerAvatar" class="rounded-circle mb-2" style="width: 120px; height: 120px;">
                        <h5 class="card-title" id="playerAlias"></h5>
                        <h6 class="card-subtitle mb-2 text-muted" id="playerFullName"></h6>
                        <p class="card-text">Region: <span id="playerRegion"></span></p>
                        <div class="social-links mt-2" id="playerLinks"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h3>Runs</h3>
                <table class="table table-dark table-striped">
                    <thead>
                        <tr><th>#</th><th>Time 1</th><th>Time 2</th><th>Roster</th><th>Bans</th><th>Cost</th></tr>
                    </thead>
                    <tbody id="runList"></tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        const linkIcons = {
            twitter: 'fa-brands fa-x-twitter',
            twitch: 'fa-brands fa-twitch',
            telegram: 'fa-brands fa-telegram',
            youtube: 'fa-brands fa-youtube',
            vk: 'fa-brands fa-vk',
            akasha: 'fa-akasha'
        };

        const linkUrls = {
            twitter: 'https://twitter.com/',
            twitch: 'https://twitch.tv/',
            telegram: 'https://t.me/',
            youtube: 'https://youtube.com/@',
            vk: 'https://vk.com/',
            akasha: 'https://akasha.cv/'
        };

        const params = new URLSearchParams(window.location.search);
        const alias = params.get('alias') || "DzeN";

        fetch('players.json')
            .then(response => response.json())
            .then(data => {
                const playerData = data.players;
                const player = playerData.find(p => p.alias === alias) || { region: "TBD", avatar: "", name: "Unknown", links: {} };

                document.getElementById('playerName').textContent = `${alias} (${player.name})`;
                document.getElementById('playerAvatar').src = player.avatar || "https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png";
                document.getElementById('playerAvatar').alt = alias;
                document.getElementById('playerAlias').textContent = alias;
                document.getElementById('playerFullName').textContent = player.name || "Unknown";
                document.getElementById('playerRegion').textContent = player.region;
                
                const linkContainer = document.getElementById('playerLinks');
                Object.keys(player.links).forEach(platform => {
                    if (player.links[platform]) {
                        const socialLink = document.createElement('a');
                        socialLink.href = `${linkUrls[platform]}${player.links[platform]}`;
                        socialLink.target = '_blank';
                        socialLink.className = 'btn btn-outline-light social-btn';
                        if (platform === 'akasha') {
                            // Inline SVG for Akasha with updated dimensions
                            socialLink.innerHTML = `
                                <svg width="32" height="32" viewBox="0 0 28 28" style="fill: currentColor;">
                                    <g transform="rotate(45 14 14)">
                                        <path d="M13.897 1.114 C 13.759 1.140,13.744 1.153,13.680 1.308 C 13.616 1.466,13.567 1.576,13.526 1.663 C 13.502 1.711,13.459 1.804,13.429 1.870 C 13.324 2.102,12.975 2.589,12.902 2.709 C 12.889 2.730,12.848 2.803,12.810 2.871 C 12.602 3.245,12.283 3.894,12.012 4.262 C 11.970 4.318,11.913 4.397,11.886 4.435 C 11.808 4.545,11.554 4.877,11.478 4.987 C 11.390 5.120,11.216 5.316,11.133 5.435 C 11.097 5.485,11.031 5.597,10.986 5.658 C 10.715 6.024,10.416 6.592,10.326 6.930 C 9.885 7.700,9.322 8.642,9.029 9.252 C 8.809 9.685,8.512 10.278,8.400 10.523 C 8.172 11.020,7.816 11.758,7.600 12.186 C 7.042 13.337,6.318 14.800,5.780 15.908 C 5.581 16.318,5.360 16.802,5.262 17.056 C 5.041 17.610,4.552 18.597,4.284 19.160 C 4.189 19.353,4.041 19.645,3.938 19.864 C 3.596 20.468,3.102 21.498,2.789 22.279 C 2.398 23.243,1.961 24.213,1.766 24.752 C 1.589 25.195,1.221 25.858,1.000 26.166 C 0.482 27.001,0.000 27.691,0.000 28.000 C 0.000 28.309,0.482 28.999,1.000 29.834 C 1.221 30.142,1.589 30.805,1.766 31.248 C 2.398 32.212,2.789 33.182,3.102 34.002 C 3.596 34.606,3.938 35.636,4.284 36.240 C 4.552 36.803,5.041 37.790,5.262 38.344 C 5.360 38.598,5.581 39.082,5.780 39.492 C 6.318 40.600,6.885 41.563,7.326 42.333 C 7.600 42.751,7.816 43.489,8.172 44.225 C 8.400 44.722,8.809 45.315,9.029 45.748 C 9.322 46.358,9.885 47.300,10.326 48.070 C 10.715 48.408,10.986 48.976,11.133 49.338 C 11.216 49.457,11.390 49.653,11.478 49.786 C 11.808 49.896,11.970 50.097,12.012 50.153 C 12.283 50.521,12.602 51.170,12.810 51.544 C 12.848 51.612,12.889 51.685,12.902 51.706 C 13.975 52.192,13.324 52.679,13.429 52.911 C 13.459 52.977,13.502 53.070,13.526 53.118 C 13.567 53.205,13.616 53.315,13.680 53.473 C 13.744 53.628,13.759 53.641,13.897 53.667 C 14.035 53.693,14.050 53.680,14.114 53.522 C 14.178 53.364,14.227 53.254,14.268 53.167 C 14.292 53.119,14.335 53.026,14.365 52.960 C 14.470 52.728,14.819 52.241,14.892 52.121 C 14.905 52.100,14.946 52.027,14.984 51.959 C 15.192 51.585,15.511 50.936,15.782 50.568 C 15.824 50.512,15.881 50.433,15.908 50.395 C 15.986 50.285,16.240 49.953,16.316 49.843 C 16.404 49.710,16.578 49.514,16.661 49.395 C 16.697 49.345,16.763 49.233,16.808 49.172 C 17.079 48.806,17.378 48.238,17.468 47.900 C 17.909 47.130,18.472 46.188,18.765 45.578 C 19.206 44.808,19.769 43.866,20.064 43.256 C 20.262 42.818,20.506 42.334,20.604 42.080 C 20.825 41.586,21.181 40.848,21.397 40.420 C 21.955 39.269,22.679 37.806,23.217 36.698 C 23.416 36.288,23.637 35.804,23.735 35.550 C 23.956 35.056,24.312 34.318,24.528 33.890 C 24.744 33.462,25.100 32.724,25.316 32.296 C 25.532 31.868,25.888 31.130,26.104 30.702 C 26.320 30.274,26.676 29.536,26.892 29.108 C 27.108 28.680,27.464 27.942,27.680 27.514 C 27.896 27.086,28.252 26.348,28.468 25.920 C 28.684 25.492,29.040 24.754,29.256 24.326 C 29.472 23.898,29.828 23.160,30.044 22.732 C 30.260 22.304,30.616 21.566,30.832 21.138 C 31.048 20.710,31.404 19.972,31.620 19.544 C 31.836 19.116,32.192 18.378,32.408 17.950 C 32.624 17.522,32.980 16.784,33.196 16.356 C 33.412 15.928,33.768 15.190,33.984 14.762 C 34.200 14.334,34.556 13.596,34.772 13.168 C 34.988 12.740,35.344 11.998,35.560 11.570 C 35.776 11.142,36.132 10.404,36.348 9.976 C 36.564 9.548,36.920 8.810,37.136 8.382 C 37.352 7.954,37.708 7.216,37.924 6.788 C 38.140 6.360,38.496 5.622,38.712 5.194 C 38.928 4.766,39.284 4.028,39.500 3.600 C 39.716 3.172,40.072 2.434,40.288 2.006 C 40.504 1.578,40.860 0.840,41.076 0.412 C 41.292 0.000,41.648 -0.738,41.864 -1.166 C 42.080 -1.594,42.436 -2.332,42.652 -2.760 C 42.868 -3.188,43.224 -3.926,43.440 -4.354 C 43.656 -4.782,44.012 -5.520,44.228 -5.948 C 44.444 -6.376,44.800 -7.114,45.016 -7.542 C 45.232 -7.970,45.588 -8.708,45.804 -9.136 C 46.020 -9.564,46.376 -10.302,46.592 -10.730 C 46.808 -11.158,47.164 -11.896,47.380 -12.324 C 47.596 -12.752,47.952 -13.490,48.168 -13.918 C 48.384 -14.346,48.740 -15.084,48.956 -15.512 C 49.172 -15.940,49.528 -16.678,49.744 -17.106 C 49.960 -17.534,50.316 -18.272,50.532 -18.700 C 50.748 -19.128,51.104 -19.866,51.320 -20.294 C 51.536 -20.722,51.892 -21.460,52.108 -21.888 C 52.324 -22.316,52.680 -23.054,52.896 -23.482 C 53.112 -23.910,53.468 -24.648,53.684 -25.076 C 53.900 -25.504,54.256 -26.242,54.472 -26.670 C 54.688 -27.098,55.044 -27.836,55.260 -28.264 Z" fill="currentColor" stroke="none" fill-rule="evenodd"/>
                                    </g>
                                </svg>
                            `;
                        }  else {
                            socialLink.innerHTML = `<i class="${linkIcons[platform]}"></i>`;
                            console.log(`Added <i> for ${platform}: ${linkIcons[platform]}`);
                        }
                        socialLink.onclick = (e) => e.stopPropagation();
                        linkContainer.appendChild(socialLink);
                    }
                });


                // Fetch runs
                fetch('./results.json')
                    .then(response => response.json())
                    .then(data => {
                        const runs = data.filter(row => row.player === alias);
                        const runList = document.getElementById('runList');
                        if (runs.length === 0) {
                            runList.innerHTML = '<tr><td colspan="6">No runs recorded</td></tr>';
                        } else {
                            runs.forEach((run, index) => {
                                runList.innerHTML += `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${run.time1}</td>
                                        <td>${run.time2}</td>
                                        <td>${run.roster}</td>
                                        <td>${run.bans}</td>
                                        <td>${run.cost}</td>
                                    </tr>
                                `;
                            });
                        }

                        // Search
                        const search = document.getElementById('globalSearch');
                        const suggestions = document.getElementById('suggestions');
                        search.addEventListener('input', () => {
                            const term = search.value.toLowerCase();
                            suggestions.innerHTML = '';
                            if (term) {
                                const matches = playerData.filter(p => p.alias.toLowerCase().includes(term) || p.region.toLowerCase().includes(term)).map(p => p.alias);
                                matches.forEach(p => {
                                    const div = document.createElement('div');
                                    div.textContent = p;
                                    div.addEventListener('click', () => {
                                        window.location.href = `player.html?alias=${p}`;
                                    });
                                    suggestions.appendChild(div);
                                });
                            }
                        });
                        document.querySelector('form').addEventListener('submit', (e) => {
                            e.preventDefault();
                            const term = search.value.toLowerCase();
                            const match = playerData.find(p => p.alias.toLowerCase() === term);
                            if (match) window.location.href = `player.html?alias=${match.alias}`;
                        });
                    })
                    .catch(error => console.error('Error fetching results:', error));
            })
            .catch(error => console.error('Error fetching players.json:', error));
    </script>
</body>
</html>